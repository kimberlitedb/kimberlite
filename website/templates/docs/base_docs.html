{% extends "base.html" %}

{% block title %}{{ title }} | Kimberlite Docs{% endblock %}

{% block header %}{% include "_partials/header_docs.html" %}{% endblock %}

{% block content %}
<div class="docs-layout">
  <div class="wrapper" style="--measure: 100%">
    <div class="docs-grid">

      <!-- LEFT: Navigation Sidebar (280px, hidden on mobile) -->
      <aside class="docs-nav-sidebar"
             data-signals='{
               {% for section in sidebar_sections %}
                 "{{ section.key }}Expanded": {{ section.default_expanded }}{% if !loop.last %},{% endif %}
               {% endfor %}
             }'>
        <nav class="docs-nav">
          {% for section in sidebar_sections %}
          <div class="docs-nav__section">
            <button class="docs-nav__heading" data-on:click="${{ section.key }}Expanded = !${{ section.key }}Expanded">
              <svg class="docs-nav__chevron" viewBox="0 0 128 128" fill="none" stroke="currentColor" stroke-width="12" stroke-linecap="round" stroke-linejoin="round" data-attr:style="${{ section.key }}Expanded ? 'transform: rotate(90deg)' : ''">
                <path d="m48 32 32 32-32 32"/>
              </svg>
              <span>{{ section.name }}</span>
            </button>
            <ul class="docs-nav__list" data-show="${{ section.key }}Expanded">
              {% for link in section.links %}
              <li><a href="{{ link.href }}" class="docs-nav__link{% if link.is_active %} is-active{% endif %}">{{ link.title }}</a></li>
              {% endfor %}
            </ul>
          </div>
          {% endfor %}
        </nav>
      </aside>

      <!-- CENTER: Main Content (flexible, max 65ch) -->
      <article class="docs-content flow">
        {% block docs_content %}{% endblock %}
      </article>

      <!-- RIGHT: TOC Sidebar (240px, hidden on mobile/tablet) -->
      <aside class="docs-toc-sidebar"{% if headings.is_empty() %} hidden{% endif %}{% if !headings.is_empty() %} data-signals='{"activeSection": "{{ headings[0].id }}"}'{% endif %}>
        <nav class="docs-toc">
          <h2 class="docs-toc__title">ON THIS PAGE</h2>
          <ul class="docs-toc__list" id="docs-toc-list">
            {% for heading in headings %}
            <li class="docs-toc__item{% if heading.level == "h3" %} docs-toc__item--nested{% endif %}">
              <a class="docs-toc__link"
                 href="#{{ heading.id }}"
                 data-class:is-active="$activeSection === '{{ heading.id }}'"
                 data-on:click__prevent="
                   document.getElementById('{{ heading.id }}').scrollIntoView({behavior: 'smooth', block: 'start'});
                   history.pushState(null, null, '#{{ heading.id }}');
                 ">
                {{ heading.text }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </nav>
      </aside>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- Docs TOC handled by Datastar with server-side rendering -->
{% endblock %}
