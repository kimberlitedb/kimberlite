[package]
name = "kimberlite-vsr"
description = "Viewstamped Replication consensus for Kimberlite"
version.workspace = true
edition.workspace = true
license.workspace = true
repository.workspace = true

[lints]
workspace = true

[dependencies]
# Internal crates
kimberlite-types.workspace = true
kimberlite-crypto = { workspace = true, features = ["verified-crypto"] }
kimberlite-kernel.workspace = true

# Bounded queue for event loop backpressure
crossbeam-queue.workspace = true

# Core
bytes.workspace = true
serde.workspace = true
serde_json.workspace = true
thiserror.workspace = true
tracing.workspace = true
getrandom.workspace = true
rand = { version = "0.8", features = ["small_rng"] }
rand_chacha = "0.9"

# Multi-node networking
mio.workspace = true
postcard.workspace = true

# Observability (OpenTelemetry)
opentelemetry = { version = "0.31", optional = true }
opentelemetry_sdk = { version = "0.31", features = ["rt-tokio"], optional = true }
opentelemetry-otlp = { version = "0.31", optional = true }
opentelemetry-prometheus = { version = "0.31", optional = true }

[dev-dependencies]
proptest.workspace = true
tempfile.workspace = true
test-case.workspace = true
rand = { version = "0.8", features = ["small_rng"] }
rand_chacha = "0.9"

[features]
# Simulation instrumentation for Byzantine testing
sim = []

# OpenTelemetry integration for metrics export
otel = ["dep:opentelemetry", "dep:opentelemetry_sdk", "dep:opentelemetry-otlp", "dep:opentelemetry-prometheus"]

[package.metadata.cargo-machete]
# opentelemetry-prometheus used in optional metrics feature
ignored = ["opentelemetry-prometheus"]
