# cargo-deny configuration
# See: https://embarkstudios.github.io/cargo-deny/

# --------------------------------------------------
# GRAPH
# --------------------------------------------------

[graph]
# Analyze all features to catch issues in optional dependencies
all-features = true
no-default-features = false

# --------------------------------------------------
# ADVISORIES
# --------------------------------------------------

[advisories]
version = 2
# The RustSec advisory database
db-urls = ["https://github.com/rustsec/advisory-db"]
# Fail on yanked crates
yanked = "deny"
# Security advisories to ignore (with justification).
#
# Review schedule: monthly (or immediately on new CVE disclosures).
# Last reviewed: 2026-02-22
# To review: cargo deny check advisories 2>&1 | grep -E "RUSTSEC|warning"
ignore = [
    # RUSTSEC-2023-0089 (atomic-polyfill): unmaintained crate.
    # Root cause: transitive dep of embedded/no-std crates in our dep tree.
    # Exploitability: none — no exploitable code path in our server context.
    # Target remediation: remove when upstream crates drop atomic-polyfill.
    { id = "RUSTSEC-2023-0089", reason = "transitive dep of no-std crates; no exploitable path in server context" },
    # RUSTSEC-2024-0436 (paste): unmaintained macro crate.
    # Root cause: transitive dependency via proc-macro consumers.
    # Exploitability: none — proc-macro with no runtime security impact.
    # Target remediation: remove when upstream crates drop paste.
    { id = "RUSTSEC-2024-0436", reason = "transitive macro dep; no runtime security impact" },
]

# --------------------------------------------------
# LICENSES
# --------------------------------------------------

[licenses]
version = 2
# Confidence threshold for license detection
confidence-threshold = 0.93
# Allowed licenses (permissive licenses suitable for compliance-focused software)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "BSL-1.0",            # Boost Software License (e.g. error-code crate)
    "CC0-1.0",
    "CDLA-Permissive-2.0", # Community Data License Agreement Permissive 2.0
    "ISC",
    "MPL-2.0",
    "OpenSSL",
    "Unicode-3.0",
    "Unlicense",
    "Zlib",               # zlib License (permissive, used by some crypto deps)
]

# Clarify licenses for crates with non-standard license files
[[licenses.clarify]]
name = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

# Exceptions for crates with complex license expressions
[[licenses.exceptions]]
name = "aws-lc-sys"
allow = ["ISC", "Apache-2.0", "OpenSSL"]

# --------------------------------------------------
# BANS
# --------------------------------------------------

[bans]
# Deny wildcard dependencies
wildcards = "deny"
# Allow multiple versions of the same crate (for now)
multiple-versions = "warn"
# Highlighting for dependency graphs
highlight = "all"
# Deny specific crates known to be problematic
deny = [
    # rand_core is allowed as a transitive dep of rand and crypto crates that
    # implement RngCore-compatible interfaces (ed25519-dalek, rand_chacha,
    # crypto-common, rand_xorshift). Direct application use should go through
    # rand instead.
    { name = "rand_core", wrappers = ["rand", "ed25519-dalek", "rand_chacha", "crypto-common", "rand_xorshift"] },
]
# Skip checking duplicate versions for these crates
skip = []
# Skip tree analysis for these crates
skip-tree = []

# --------------------------------------------------
# SOURCES
# --------------------------------------------------

[sources]
# Deny unknown registries
unknown-registry = "deny"
# Deny git dependencies (require explicit allow)
unknown-git = "deny"
# Only allow crates.io
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
# Allow specific git sources if needed
# allow-git = []

# --------------------------------------------------
# OUTPUT
# --------------------------------------------------

[output]
# Show feature resolution in output
feature-depth = 1
